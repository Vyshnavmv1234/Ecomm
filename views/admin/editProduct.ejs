<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Edit Product | WestLane</title>

<style>
/* ===== RESET ===== */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family: "Inter", Arial, sans-serif;
}
.breadcrumb-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  width: 100%; /* ðŸ”¥ THIS IS THE KEY */
}

.breadcrumb {
  display: flex;

  gap: 6px;
  font-size: 14px;
  color: #666;
}

.breadcrumb a {
  color: #6b46c1;
  text-decoration: none;
}

.breadcrumb .active {
  color: #111;
  font-weight: 500;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:25px;
  margin-bottom:25px;
}
.image-box{
  border:2px dashed #ddd;
  border-radius:12px;
  padding:40px;
  text-align:center;
  background:#fafafa;
}

.image-box p{
  font-size:13px;
  color:#777;
  margin:15px 0;
}

.image-box button{
  background:#ece7ff;
  border:none;
  padding:10px 16px;
  border-radius:8px;
  color:#5b4bdb;
  cursor:pointer;
}

body{
  background:#f6f6f8;
  min-height:100vh;
}

/* ===== MAIN ===== */
.main{
  margin-top: 60px;
  margin-left:230px; /* sidebar width */
  padding:30px 40px;
}

/* ===== TOP BAR ===== */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  margin-bottom:25px;
}

.topbar h2{
  font-size:22px;
  font-weight:600;
}

.breadcrumb{
  font-size:13px;
  color:#888;
  margin-top:6px;
}

.actions{
  display:flex;
  gap:12px;
}

.btn{
  padding:10px 16px;
  border-radius:8px;
  font-size:14px;
  cursor:pointer;
  border:none;
}

.btn-cancel{
  background:#fff;
  border:1px solid #b0b6c3;
  color:#333;
}

.btn-primary{
  background:#c9b1a8;
  color:#fff;
}

/* ===== CARD ===== */
.card{
  background:#fff;
  border-radius:14px;
  padding:28px;
  max-width:900px;
}

/* ===== FORM ===== */
label{
  font-size:13px;
  color:#6b7280;
  display:block;
  margin-bottom:6px;
}

input, textarea{
  width:100%;
  padding:12px 14px;
  border-radius:8px;
  border:1px solid #e2e2e2;
  background:#fafafa;
  font-size:14px;
  margin-bottom:18px;
}

textarea{
  min-height:140px;
  resize:none;
}

/* ===== SECTION TITLE ===== */
.section-title{
  font-size:16px;
  font-weight:600;
  margin-bottom:20px;
}
</style>
</head>

<body>

<!-- HEADER -->
<%- include("../../views/partials/admin/header") %>

<!-- SIDEBAR -->
<%- include("../../views/partials/admin/sidebar") %>

<!-- MAIN -->
<div class="main">

  <!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-left">
    <h2>Edit Product</h2>

    <nav class="breadcrumb">
      <a href="/admin/adminDashboard">Dashboard</a>
      <span>â€º</span>
      <a href="/admin/products">Products</a>
      <span>â€º</span>
      <span class="active">Edit Product</span>
    </nav>
  </div>

  <form id="formId">
  <div class="actions">
    <button class="btn btn-primary">Save Product</button>
    <button class="btn btn-cancel">Cancel</button>
  </div>
</div>


  <!-- GENERAL INFORMATION -->
  <div class="card">
    <div class="section-title">General Information</div>

    <label>Product Name</label>
    <input id="productId" name="productName" type="text" value="<%=product.name%>">

    <label>Product Title</label>
    <input id="productTitle" name="productTitle" type="text" value="<%=product.title%>">

    <label>Description</label>
    <textarea id="descriptionId" name="productDescription">
      <%=product.description%>
      </textarea>

      <div class="card">
        <h3 style="margin-bottom:20px;">Pricing</h3>

        <label>Base Price</label>
        <input id="priceId" name="price" type="number" value="<%=product.price%>" placeholder="Type base price here...">
        <small class="error" id="priceError"></small>

        <label>Discount Percentage (%)</label>
        <input id="discountId" name="discount" value="<%=product.discount%>" type="number" placeholder="Type discount percentage...">
        <small class="error" id="discountError"></small>
      </div>
      
       <!-- GENERAL PHOTO (TITLE ONLY LIKE SCREENSHOT) -->
  <div class="card">
        <h3 style="margin-bottom:20px;">General Photo</h3>

        <div class="image-box">
          <p>Drag and drop image here, or click add image</p>
          <input id="imageInput" type="file" name="images" multiple>
          <button type="button">Add Image</button>
        </div>
      </div>

      
  </div>
  </form>
</div>
  <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />

    <!-- Toastify JS -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>
  function showToast(message, type = "success") {
    Toastify({
      text: message,
      duration: 3000,
      gravity: "bottom",
      position: "center",
      close: true,
      stopOnFocus: true,
      style: {
        background:
          type === "success"
            ? "linear-gradient(to right, #16a34a, #22c55e)"
            : "linear-gradient(to right, #dc2626, #ef4444)",
      }
    }).showToast();
  }

  const form = document.getElementById("formId");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // -------- GET VALUES --------
    const name = document.getElementById("productId").value.trim();
    const title = document.getElementById("productTitle").value.trim();
    const description = document.getElementById("descriptionId").value.trim();
    const price = document.getElementById("priceId").value.trim();
    const discount = document.getElementById("discountId").value.trim();
    const images = document.getElementById("imageInput").files;

    // -------- VALIDATION --------
    const nameRegex = /^(?=.*[a-zA-Z])[a-zA-Z0-9\s\-]+$/;

    if (!name || name.length < 3) {
      return showToast("Product name must be at least 3 characters", "error");
    }

    if (!nameRegex.test(name)) {
      return showToast(
        "Product name must contain letters (not only numbers or symbols)",
        "error"
      );
    }

    const titleRegex = /^(?=.*[a-zA-Z])[a-zA-Z0-9\s\-]+$/;

    if (!title || title.length < 3) {
      return showToast("Product title must be at least 3 characters", "error");
    }

    if (!titleRegex.test(title)) {
      return showToast(
        "Product title must contain letters (not only numbers)",
        "error"
      );
    }


    if (!description || description.length < 10) {
      return showToast("Description must be at least 10 characters", "error");
    }

    if (!price || isNaN(price) || Number(price) <= 0) {
      return showToast("Price must be a valid number greater than 0", "error");
    }

    if (
      discount === "" ||
      isNaN(discount) ||
      Number(discount) < 0 ||
      Number(discount) > 100
    ) {
      return showToast("Discount must be between 0 and 100", "error");
    }

    // -------- FORM DATA --------
    const productId = "<%= product._id %>";
    const formData = new FormData();

    formData.append("name", name);
    formData.append("title", title);
    formData.append("description", description);
    formData.append("price", price);
    formData.append("discount", discount);

    // images are OPTIONAL in edit
    for (let img of images) {
      formData.append("images", img);
    }

    // -------- API CALL --------
    const res = await fetch(`/admin/updateProduct/${productId}`, {
      method: "PATCH",
      body: formData
    });

    const data = await res.json();

    if (res.ok && data.success) {
      showToast("Product Edited Successfully", "success");
      setTimeout(() => {
        window.location.href = "/admin/products";
      }, 1500);
    } else {
      showToast(data.message || "Failed to update product", "error");
    }
  });
</script>


</body>
</html>
